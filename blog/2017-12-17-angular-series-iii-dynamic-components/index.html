<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="map[]"><title>Angular Series III - Dynamic components</title><meta name=generator content="Hugo 0.68.3"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet type=text/css href=https://adrianabreu.github.io/css/main.css><link rel=stylesheet type=text/css href=https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800" rel=stylesheet><!--[if lt IE 9]><script src=https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js></script><script src=https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js></script><![endif]--></head><body><div id=wrap><nav class="navbar navbar-default"><div class=container><div class=navbar-header><a class=navbar-brand href=https://adrianabreu.github.io><i class="fa fa-home"></i></a></div><div id=navbar><ul class="nav navbar-nav navbar-right"><li><a href=/>INICIO</a></li><li><a href=/blog/>BLOG</a></li><li><a href=/knowledge/>KNOWLEDGE</a></li><li><a href=/archive/>ARCHIVE</a></li></ul></div></div></nav><div class=container><div class=aa-blogpost><div class=aa-blogpost-header><div class=aa-blogpost-header_title><a href=/blog/2017-12-17-angular-series-iii-dynamic-components/>Angular Series III - Dynamic components</a></div><div class=aa-blogpost-header_date>17-12-2017</div></div></div><div class=aa-blogpost-content><p>Antes de terminar repasando el tema de <em>templating</em>, quiero hacer un inciso. Existen ciertos casos donde el templating es insuficiente y lo que necesitamos es simplemente escoger dinámicamente que componente vamos a renderizar.</p><p>Esto está documentado en la documentación de angular bajo el nombre de <a href=https://angular.io/guide/dynamic-component-loader>Dynamic Components</a>.</p><h3 id=cómo-funcionan-estos-dynamics-components>¿Cómo funcionan estos dynamics components?</h3><p>Explicado mal y pronto, la idea es: Escoger un elemento de la vista que actue de contenedor e inyectar el componente debe ir ahí.</p><p><strong>¿Cómo se puede hacer esto?</strong></p><p>Antes de empezar he de aclarar que los componentes dinámicos que queramos crear deben ser declarados como <a href=https://angular.io/guide/ngmodule-faq#what-is-an-entry-component>Entry Components</a>.</p><p>Un entry component es un un componente que no se usa de forma directa en ninguna plantilla. Por ejemplo un componente dinámico como este será eliminado por el compilador. Al declararlo como entry components el compilador no lo eliminará y podremos utilizarlo.</p><p>Ahora que ya tenemos esto claro, veamos lo que necesitamos: El <a href=https://angular.io/api/core/ComponentFactoryResolver>compontentFactoryResolver</a> y el <a href=https://angular.io/api/core/ViewContainerRef>ViewContainerRef</a>.</p><h3 id=component-factory>Component Factory</h3><p>Normalmente en nuestra aplicación instanciamos múltiples veces cada componente, por tanto existe una factoría responsable de su creación.</p><p>Esta factoría se puede crear a través de un servicio llamado <a href=https://angular.io/api/core/ComponentFactoryResolver>Component Factory Resolver</a>.</p><p>Un ejemplo muy sencillo donde inyectamos conseguimos la factoría necesaria para un determinado componente.</p><p>Hemos:</p><ul><li>Creado un componente dinámico de tipo &ldquo;entry component&rdquo;.</li><li>Cargado la factoría del componente a través de su tipo.</li></ul><h3 id=viewcontainerref>ViewContainerRef</h3><p>Una vez que tenemos la factoría del componente necesitamos inyectarlo en algún sitio.</p><p>Aquí entra en juego el ViewContainerRef.</p><p>Primero hemos de declarar un elemento con un nombre, por ejemplo:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>ng-template</span> <span style=color:#960050;background-color:#1e0010>#</span><span style=color:#a6e22e>dynamiccomponent</span>&gt;
&lt;/<span style=color:#f92672>ng-template</span>&gt;</code></pre></div><p>Ahora hemos de hacer una query a este elemento de la plantilla en el ts e inyectar el ViewContainerRef, ambos están en el paquete <strong>@angular/core</strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;dynamiccomponent&#39;</span>)
  <span style=color:#a6e22e>viewRef</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>_cfr</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>,
   <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>_vcr</span>: <span style=color:#66d9ef>ViewContainerRef</span>) {
  }
</code></pre></div><p>Y lo que haremos será inyectar nuestro componente a través del método <strong>createComponent</strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  <span style=color:#a6e22e>onClick() {</span>
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_cfr</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#a6e22e>DynamicComponent</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_vcr</span>.<span style=color:#a6e22e>clear</span>();
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>viewRef</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_vcr</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>componentFactory</span>);
  }
</code></pre></div><p>Aquí un pequeño ejemplo funcional.</p><p>Et voilá! Ya tenemos un componente que podemos generar dinámicamente cada vez que pulsamos un botón.</p><h3 id=actualizar-los-inputs-del-componente>Actualizar los inputs del componente</h3><p>Ahora que ya hemos renderizado el componente nos quedaría gestionar la interacción con el componente. Empecemos por los inputs. Obviamente necesitariamos mostrar algo más que una plantilla aquí, pero es un problema con fácil solucion.</p><p>Una vez que hemos creado el componente, tenemos una referencia a su instancia. Hagamos que nuestro dynamic component acepte un input llamado &ldquo;test&rdquo; que contiene una string a mostrar en la vista.</p><p>Si cogemos el compRef que hemos creado previamente podemos acceder a su instancia y modificar las propiedades directamente:</p><p><code>(&lt;any>compRef.instance).greeting = 'Salutations!'</code></p><p>Como vemos, setear el input de nuestro componente ha sido increíblemente sencillo. :)</p><h3 id=actualizar-los-outputs-del-componente>Actualizar los outputs del componente</h3><p>De la misma forma que podemos acceder a los inputs también podemos suscribirnos a los outputs. (Sí, a fin de cuentas, los event emitters no son más que observables).</p><p>Vamos a emitir un pequeño evento con un mensaje desde el hijo al pulsar un botón y a renderizar este mensaje en la plantilla del componente padre.</p><p>Para ello, añadimos un evento en el hijo:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  <span style=color:#66d9ef>@Output</span>()
  <span style=color:#a6e22e>farewell</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>EventEmitter</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>string</span><span style=color:#f92672>&gt;</span>();

  <span style=color:#a6e22e>sayGoodBye() {</span>
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>farewell</span>.<span style=color:#a6e22e>emit</span>(<span style=color:#e6db74>&#39;Bye bye Alabama...&#39;</span>);
  }
</code></pre></div><p>Y lo que tenemos que hacer es suscribirnos en el padre, para mostrar el mensaje:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>    (<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>any</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>instance</span>).<span style=color:#a6e22e>farewell</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>farewellMessage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>x</span>);
</code></pre></div><h3 id=un-componente-versátil>Un componente versátil</h3><p>Ahora que hemos ido punto por punto revisando los pasos necesarios para gestionar un componente dinámic, hagamos un pequeño sumario:</p><ul><li>Necesitamos un lugar donde inyectar el componente.</li><li>Necesitamos que el servicio nos provea de una factoría responsable de crear el componente.</li><li>Tenemos que crear una instancia del componente en la vista.</li><li>Tenemos que colocar los inputs del componente.</li><li>Tenemos que subscribirnos a los outputs del componente.</li></ul><p>¿Por qué no encapsulamos todo este comportamiento en un componente?</p><p>Vamos a darle más sentido a nuestro <strong>Dynamic Component</strong> y vamos a hacerle responsable de manejar estas tareas.</p><p>Lo primero será encargarnos de recibir el tipo de componente por input y de crearlo en la vista correspondiente.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>Input</span>, <span style=color:#a6e22e>ViewChild</span>, <span style=color:#a6e22e>ViewContainerRef</span>, <span style=color:#a6e22e>ComponentFactoryResolver</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;

<span style=color:#66d9ef>@Component</span>({
  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;dynamic-component&#39;</span>,
  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span><span style=color:#e6db74>   &lt;ng-template #dynamiccomponent&gt;&lt;/ng-template&gt;
</span><span style=color:#e6db74>  `</span>
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicComponent</span>  {

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>compType</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;dynamiccomponent&#39;</span>, {<span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> })
  <span style=color:#a6e22e>compRef</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>_cfr</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>) {

  }

  <span style=color:#a6e22e>ngOnChanges() {</span>
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>clear</span>();
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>compFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_cfr</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compType</span>); 
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#a6e22e>compFactory</span>);   
  }
}
</code></pre></div><p>Como vemos, han habido unos pequeños cambios. Por ejemplo la sección de <strong>ViewChild</strong> se ha simplificado utilizando la propiedad read.</p><p>Ahora tenemos que gestionar los inputs y outputs. ¿Como podemos hacerlo?</p><p>Para ambos casos lo mejor seria pasar un objeto que represente el nombre del input / output y el valor (o método) correspondiente.</p><p>Empecemos por los inputs, que son el caso más sencillo. La idea es muy simple, iterar el objeto nombre / valor y setearlo en la instancia, quedaría un código tal que:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>Input</span>, <span style=color:#a6e22e>ViewChild</span>, <span style=color:#a6e22e>ViewContainerRef</span>, <span style=color:#a6e22e>ComponentFactoryResolver</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;

<span style=color:#66d9ef>@Component</span>({
  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;dynamic-component&#39;</span>,
  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span><span style=color:#e6db74>   &lt;ng-template #dynamiccomponent&gt;&lt;/ng-template&gt;
</span><span style=color:#e6db74>  `</span>
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicComponent</span>  {

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>compType</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>params</span>: <span style=color:#66d9ef>Param</span>[];

  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;dynamiccomponent&#39;</span>, {<span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> })
  <span style=color:#a6e22e>compRef</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>_cfr</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>) {

  }

  <span style=color:#a6e22e>ngOnChanges() {</span>
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>clear</span>();
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>compFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_cfr</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compType</span>); 
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>component</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#a6e22e>compFactory</span>);
    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>param</span> <span style=color:#f92672>=&gt;</span> {
        <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>instance</span>[<span style=color:#a6e22e>param</span>.<span style=color:#a6e22e>name</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>param</span>.<span style=color:#a6e22e>value</span>;
      });
    } 
  }
  
}
</code></pre></div><p>El tipo param solo indica la clave nombre / valor que hemos indicado antes.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  <span style=color:#66d9ef>export</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Param</span> {
    <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>string</span>;
    <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>any</span>;
  }
</code></pre></div><p>Ahora que ya tenemos los inputs, pasaremos al tema de los outputs. Como necesitamos emitir un valor hacia el padre me he inspirado en el &ldquo;eventBus&rdquo; para solucionar la problemática. Condensaremos n outputs en un único output con un objeto nombre / valor.</p><p>Al componente le pasaremos un array de nombres de eventos como estos:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  <span style=color:#a6e22e>outputs</span> <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;sayHi&#39;</span>];
</code></pre></div><p>Y además nos hará falta una función en el padre que gestione este evento.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts>  (<span style=color:#a6e22e>outputBus</span>)<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;onEventEmitted($event)&#34;</span>

  <span style=color:#a6e22e>onEventEmitted</span>(<span style=color:#a6e22e>event</span>) {
    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Gotcha!, I received&#39;</span>, <span style=color:#a6e22e>event</span>);
  }
</code></pre></div><p>Y ahora nos suscribiriemos y relazanremos a través del <em>eventBus</em> que hemos creado:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>Input</span>, <span style=color:#a6e22e>ViewChild</span>, <span style=color:#a6e22e>ViewContainerRef</span>, <span style=color:#a6e22e>ComponentFactoryResolver</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;@angular/core&#39;</span>;

<span style=color:#66d9ef>@Component</span>({
  <span style=color:#a6e22e>selector</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;dynamic-component&#39;</span>,
  <span style=color:#a6e22e>template</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`
</span><span style=color:#e6db74>   &lt;ng-template #dynamiccomponent&gt;&lt;/ng-template&gt;
</span><span style=color:#e6db74>  `</span>
})
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicComponent</span>  {

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>compType</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>params</span>: <span style=color:#66d9ef>Param</span>[];

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>outputs</span>: <span style=color:#66d9ef>any</span>[];

  <span style=color:#66d9ef>@Output</span>()
  <span style=color:#a6e22e>outputBus</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>EventEmitter</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>any</span><span style=color:#f92672>&gt;</span>();

  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;dynamiccomponent&#39;</span>, { <span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> })
  <span style=color:#a6e22e>compRef</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>_cfr</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>) {

  }

  <span style=color:#a6e22e>ngOnChanges() {</span>
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>clear</span>();
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>compFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_cfr</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compType</span>);
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>component</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#a6e22e>compFactory</span>);
    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>param</span> <span style=color:#f92672>=&gt;</span> {
        <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>instance</span>[<span style=color:#a6e22e>param</span>.<span style=color:#a6e22e>name</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>param</span>.<span style=color:#a6e22e>value</span>;
      });
    }

    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>outputs</span>) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>outputs</span>.<span style=color:#a6e22e>map</span>( <span style=color:#a6e22e>output</span> <span style=color:#f92672>=&gt;</span> 
      <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>instance</span>[<span style=color:#a6e22e>output</span>].<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>v</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>outputBus</span>.<span style=color:#a6e22e>emit</span>({ <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>output</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>v</span>})));
    }
  }
}
</code></pre></div><p>Y como vemos, ¡ahora podemos ver en la consola ambos eventos lanzados por los distintos componentes!</p><p>Aunque en principio quería parar el artículo aquí, aún queda algo muy importante: Gestionar los cambios. Hemos de actualizar los inputs cuando corresponda y hemos de gestionar todas estas suscripciones que estamos creando.</p><p>Distinguimos tres pasos:</p><ol><li>Conseguir la instancia del componente.</li><li>Setear los inputs.</li><li>Suscribir / desuscribir los outputs.</li></ol><p>Como son pasos muy simples y quiero que queden claros, he pasado directamente a poner el código como si fueran un conjunto de pasos que se repiten.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DynamicComponent</span> {

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>compType</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>params</span>: <span style=color:#66d9ef>Param</span>[];

  <span style=color:#66d9ef>@Input</span>()
  <span style=color:#a6e22e>outputs</span>: <span style=color:#66d9ef>any</span>[];

  <span style=color:#66d9ef>@Output</span>()
  <span style=color:#a6e22e>outputBus</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>EventEmitter</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>any</span><span style=color:#f92672>&gt;</span>();

  <span style=color:#66d9ef>@ViewChild</span>(<span style=color:#e6db74>&#39;dynamiccomponent&#39;</span>, { <span style=color:#a6e22e>read</span>: <span style=color:#66d9ef>ViewContainerRef</span> })
  <span style=color:#a6e22e>compRef</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#a6e22e>component</span>: <span style=color:#66d9ef>any</span>;

  <span style=color:#a6e22e>subscriptions</span>: <span style=color:#66d9ef>Subscription</span>[] <span style=color:#f92672>=</span> [];

  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>_cfr</span>: <span style=color:#66d9ef>ComponentFactoryResolver</span>) {

  }

  <span style=color:#a6e22e>ngOnChanges</span>(<span style=color:#a6e22e>changes</span>: <span style=color:#66d9ef>SimpleChanges</span>) {
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changes</span>[<span style=color:#e6db74>&#39;compType&#39;</span>]) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>clearSubscriptions</span>();
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createComponent</span>();
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateInputs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>component</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>);
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateOutputs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>component</span>);
    }

    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changes</span>[<span style=color:#e6db74>&#39;params&#39;</span>]) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateInputs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>component</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>);
    }

    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>changes</span>[<span style=color:#e6db74>&#39;outputs&#39;</span>]) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>updateOutputs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>component</span>);
    }
  }

  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>createComponent() {</span>
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>clear</span>();
    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>compFactory</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_cfr</span>.<span style=color:#a6e22e>resolveComponentFactory</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compType</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>component</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compRef</span>.<span style=color:#a6e22e>createComponent</span>(<span style=color:#a6e22e>compFactory</span>);
  }

  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>updateInputs</span>(<span style=color:#a6e22e>component</span>, <span style=color:#a6e22e>params</span>) {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>params</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>param</span> <span style=color:#f92672>=&gt;</span> {
      <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>instance</span>[<span style=color:#a6e22e>param</span>.<span style=color:#a6e22e>name</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>param</span>.<span style=color:#a6e22e>value</span>;
    });
  }

  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>clearSubscriptions() {</span>
    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscriptions</span>) {
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscriptions</span>.<span style=color:#a6e22e>map</span>(<span style=color:#a6e22e>subscription</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>subscription</span>.<span style=color:#a6e22e>unsubscribe</span>());
    }
  }

  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>updateOutputs</span>(<span style=color:#a6e22e>component</span>) {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>clearSubscriptions</span>();
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>outputs</span>.<span style=color:#a6e22e>map</span>( <span style=color:#a6e22e>output</span> <span style=color:#f92672>=&gt;</span> {
      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>subscription</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>component</span>.<span style=color:#a6e22e>instance</span>[<span style=color:#a6e22e>output</span>].<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>v</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>outputBus</span>.<span style=color:#a6e22e>emit</span>({ <span style=color:#a6e22e>name</span>: <span style=color:#66d9ef>output</span>, <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>v</span>}));
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscriptions</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>subscription</span>)
    });
  }
}
</code></pre></div><p>¡Con esto ya estamos listos para crear componentes dinámicos!</p></div></div><div class=aa-navigator><div class=row><div class="col-xs-2 col-lg-3" style=text-align:right><a href=https://adrianabreu.github.io/blog/2019-02-05-data-i-introduccion-al-datawarehouse/><i class="fa fa-2x fa-arrow-left" aria-hidden=true></i></a></div><div class="col-xs-8 col-lg-6 center"></div><div class="col-xs-2 col-lg-3"><a class="btn-floating btn-large paginate-button" href=https://adrianabreu.github.io/blog/2017-11-18-angular-series-ii-templating/><i class="fa fa-2x fa-arrow-right" aria-hidden=true></i></a></div></div></div></div></div></body></html>