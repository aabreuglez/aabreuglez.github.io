<!DOCTYPE html>
<html lang="es-ES">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
  <title>Interacción a través de ViewChild en Angular</title>
  <link href="http://adrianabreu.github.io/css/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="http://adrianabreu.github.io/css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/default.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>

<body>  <nav>
    <div id="top-nav" class="nav-wrapper">
        <a href="#" data-activates="mobile-demo" class="hide-on-med-and-up button-collapse"><i class="mdi-action-view-headline"></i></a>
        <ul class="hide-on-small-only">
            <li><a href="http://adrianabreu.github.io"><i class="mdi-action-home left"></i>Home<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
            <li><a href="http://adrianabreu.github.io/post/"><i class="mdi-action-description left"></i>Blog<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
            <li><a href="http://adrianabreu.github.io/projects/"><i class="mdi-action-pageview left"></i>Proyectos<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
            <li><a href="http://adrianabreu.github.io/about/"><i class="mdi-action-account-circle left"></i>Contáctame<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
        </ul>
        <ul class="side-nav" id="mobile-demo">
            <li><a href="http://adrianabreu.github.io"><i class="mdi-action-home left"></i>Home<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
            <li><a href="http://adrianabreu.github.io/post/"><i class="mdi-action-description left"></i>Blog<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
            <li><a href="http://adrianabreu.github.io/projects/"><i class="mdi-action-pageview left"></i>Proyectos<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
            <li><a href="http://adrianabreu.github.io/about/"><i class="mdi-action-account-circle left"></i>Contáctame<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="single-section">

        <div class="row">
            <div class="col s12">
                <h4>Interacción a través de ViewChild en Angular</h4>
                <p>
                    
                </p>
                <p>24 Mar 2017 
                </p>
                <p><p>Hoy me he encontrado con una situación peculiar en un código. Aunque considero que quizás como está realizada la tarea no sea la mejor opción, creo que es un buen ejemplo para entender algunos conceptos de Angular.</p>

<p>Partiendo de una aplicaicón muy básica donde tenemos dos componentes: <strong>AppComponent</strong> y <strong>ChildComponent</strong>, vamos a renderizar dinámicamente el componente hijo desde el componente padre y ejecutar una serie de acciones.</p>

<p>Empecemos por el componente padre:</p>

<pre><code>&lt;h1&gt;
  {{title}}
&lt;/h1&gt;

&lt;button type=&quot;button&quot; (click)=&quot;renderChildAndDoChildStuff()&quot;&gt;Render the child!&lt;/button&gt;
&lt;child *ngIf=&quot;timeToRenderChild&quot;&gt;&lt;/child&gt;
</code></pre>

<p><strong>app.component.ts</strong></p>

<pre><code>import { Component, ViewChild } from '@angular/core';
import { ChildComponent } from './child/child.component';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  title = 'app works!';

  @ViewChild(ChildComponent)
  private childComponent: ChildComponent;

  private timeToRenderChild: boolean;

  constructor() {
    this.timeToRenderChild = false;
  }

  renderChildAndDoChildStuff() {
    this.timeToRenderChild = true;
    this.childComponent.doStuff();
  }
}

</code></pre>

<p><strong>app.component.html</strong></p>

<p>Varios detalles:</p>

<ol>
<li><p>La directiva ngIf hace que hasta que no se cumpla la condición no empiece el renderizado del componente hijo.</p></li>

<li><p>El decorator @ViewChild permite que un componente padre acceda a las propiedades de un componente hijo.</p></li>
</ol>

<p>La funcion doStuff no hace más que modificar un valor de texto en el componente hijo. ¿Que pasa cuando hacemos click en el botón?</p>

<p>Tenemos un error, que nos dice que nuestro componente aún está en estado undefined.
¿Como podemos saber que nuestro componente está listo?</p>

<p>Aquí entran en juego los <a href="https://angular.io/docs/ts/latest/guide/lifecycle-hooks.html">lifecycle hooks</a>. Si utlizamos OnInit, ya estará nuestro componente resuelto. Pero, y aquí el quid del post, aún falta una cosa. Y es que el componente padre sepa que el hijo ha terminado de instanciarse. En un principio notificar una acción de un componente hijo a un componente padre es tan sencillo como usar un evento.</p>

<p>Pero esto no es suficiente: Cuando el componente hijo ya esté creado será demasiado tarde como para modificar el componente padre en el mismo ciclo (debido a la estructura en árbol del detector de cambios), por tanto, es necesario esperar un tiempo, y esto se consigue utilizando por ejemplo un setTimeOut.</p>

<pre><code>setTimeout(() =&gt; this.childComponent.doStuff(), 0);
</code></pre>

<p>Para ver el código del post:
<a href="https://github.com/adrianabreu/angular_viewchild_lifecycle">https://github.com/adrianabreu/angular_viewchild_lifecycle</a></p>

<p>Para más información:
<a href="https://blog.thoughtram.io/angular/2016/02/22/angular-2-change-detection-explained.html#smarter-change-detection">https://blog.thoughtram.io/angular/2016/02/22/angular-2-change-detection-explained.html#smarter-change-detection</a></p>
</p>

            </div>
        </div>
        <div class="row">
            <div class="col s3 m1">
                
                <a class="btn-floating btn-large disabled"><i class="mdi-navigation-arrow-back"></i></a> 
            </div>
            <div class="col s6 m10 center">&nbsp</div>
            <div class="col s3 m1">
                
                <a class="btn-floating btn-large paginate-button" href="http://adrianabreu.github.io/post/2017-03-12-Como-construir-un-portfolio/"><i class="mdi-navigation-arrow-forward"></i></a>                
            </div>
        </div>
    </div>
</div>

<footer class="page-footer">
  <div class="footer-copyright">
    <div class="container">
      2017 Adrián Abreu
    </div>
  </div>
</footer>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="http://adrianabreu.github.io/js/materialize.min.js"></script>
<script src="http://adrianabreu.github.io/js/init.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();

</script>


</body>

</html>